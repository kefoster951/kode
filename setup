#!/bin/env bash

#************************************************#
#                                                #
#   kode v2.0                                    #
#   A bash script to add header in your code.    #
#   Author : https://github.com/laraib07         #
#                                                #
#************************************************#

#colors
R='\033[1;31m'
G='\033[1;32m'
W='\033[1;37m'
OFF='\033[0m'

banner()
{
        clear
        echo -e ${R}
        echo -e "  ████████████████████████"
        echo -e "  █▄─█─▄█─▄▄─█▄─▄▄▀█▄─▄▄─█"
        echo -e "  ██─▄▀██─██─██─██─██─▄█▀█"
        echo -e "  ▀▄▄▀▄▄▀▄▄▄▄▀▄▄▄▄▀▀▄▄▄▄▄▀"
        echo -e ${OFF}
}

set_author()
{
        echo -e "\n${R} ≫${W} Enter author's name :${OFF} \c"
        read AUTHOR_NAME

        AUTHOR_NAME=$(printf "%.30s" "$AUTHOR_NAME")
        sed -i "0,/^AUTHOR.*/{s//AUTHOR=\"${AUTHOR_NAME}\"/}" ~/.kodeconfig

        if [ $? -gt 0 ]
        then
                echo -e "${G} ≫${W} Author name $AUTHOR_NAME set successfully."
        fi
}

set_text_editor()
{
        false
        while [ $? -gt 0 ]
        do
                echo -e "\n${R} ≫${W} Enter text editor :${OFF} \c"
                read

                which $REPLY > /dev/null
                if [ $? -gt 0 ]
                then
                        echo -e "${R} ≫ error${W} : $REPLY not found"
                        echo -ne "   try again\r"

                else
                        sed -i "0,/^TXT_EDITOR.*/{s//TXT_EDITOR=${REPLY}/}" ~/.kodeconfig

                        echo -e "${G} ≫${W} $REPLY set successfully."

                fi
                which $REPLY > /dev/null
        done
}

make_config_file()
{
        touch ~/.kodeconfig
        echo 'AUTHOR="no_name"'>> ~/.kodeconfig
        echo 'TXT_EDITOR=nano' >> ~/.kodeconfig
        echo 'DEFAULT_TXT_EDITOR="nano"' >>~/.kodeconfig

}

download_kode()
{
	which wget > /dev/null
	if [ $? -gt 0 ]
	then
		wget https://raw.githubusercontent.com/laraib07/kode/master/kode && chmod 755 kode

	else
		curl -O  https://raw.githubusercontent.com/laraib07/kode/master/kode && chmod 755 kode 

	fi

}

signal()
{
	[[ -f ~/.kodeconfig ]] && rm -f ~/.kodeconfig
	[[ -f kode ]] && rm -f kode
}

trap signal 1 2 3 15 20


banner
download_kode
make_config_file
set_author
echo
set_text_editor

exit 0
